# Bowhead Whale - D OAuth

> 去中心化 OAuth 基礎建設，基於 Sui Move 智能合約、Walrus Blob 存儲和 Seal 加密協議

## 📋 項目簡介

Bowhead Whale (簡稱 D OAuth) 是一個**去中心化的 OAuth 基礎建設**，為 Web3 生態系統提供安全、去中心化的用戶數據管理和授權機制。通過結合 **Walrus Blob 存儲**和 **Seal 加密協議**，實現了完全去中心化的用戶數據管理與第三方服務授權流程。

## 🎯 核心痛點與解決方案

### 痛點問題

#### 1. **傳統 OAuth 的中心化依賴**
- ❌ 傳統 OAuth 2.0 依賴中心化授權服務器
- ❌ 單點故障風險，服務中斷影響所有依賴服務
- ❌ 用戶數據由中心化服務商控制，缺乏自主權

#### 2. **用戶數據管理分散且不安全**
- ❌ 用戶數據（圖片、影片、文字、密碼）分散在多個平台
- ❌ 缺乏統一的加密存儲解決方案
- ❌ 密碼管理工具與數據存儲分離，使用體驗割裂

#### 3. **第三方服務獲取用戶數據的信任問題**
- ❌ 第三方服務需要用戶直接提供敏感數據
- ❌ 缺乏細粒度的授權控制（讀取、編輯、刪除權限）
- ❌ 無法追蹤和撤銷已授權的訪問

#### 4. **新用戶註冊流程複雜**
- ❌ 用戶首次使用第三方服務需要手動註冊
- ❌ 無法自動化密碼管理和同步

### 解決方案

#### ✅ **去中心化 OAuth 機制**
- 基於 Sui Move 智能合約實現完全去中心化的授權流程
- 無需中心化服務器，降低單點故障風險
- 用戶通過錢包簽名完成授權，完全自主控制

#### ✅ **統一數據管理 + 端到端加密**
- 整合 Walrus Blob 存儲（去中心化存儲）和 Seal 加密協議
- 用戶數據（圖片、影片、文字、密碼）統一管理
- 所有數據在客戶端加密後存儲，只有授權方可以解密

#### ✅ **細粒度授權控制**
- 支持 View、Edit、Delete 三種權限級別
- 基於時間的訪問控制（AccessEntry with expiration）
- 鏈上記錄所有授權關係，可追蹤可撤銷

#### ✅ **自動化密碼管理**
- 首次登入第三方服務時自動創建密碼
- 支持 Common 密碼機制，一次設定多服務使用
- 無縫整合到 OAuth 流程中

## 🛠 技術架構

### 核心技術棧

- **Sui Move 智能合約** - 去中心化授權邏輯與數據結構管理
- **Walrus Blob 存儲** - 去中心化數據存儲基礎設施
- **Seal 加密協議** - 端到端加密與訪問策略控制
- **錢包簽名認證** - 用戶身份驗證與授權簽名

### 技術實現要點

1. **鏈上授權管理**
   - `OAuthService` - 第三方服務註冊與白名單管理
   - `OAuthGrant` - 用戶授權記錄（包含資源類型和時效）
   - `check_policy` - 驗證服務是否在白名單內

2. **數據結構設計**
   - `DataVault` - 通用數據保險庫（圖片、影片、文字）
   - `KeyVault` - 密碼保險庫
   - `AccessEntry` - 帶時效的訪問控制條目

3. **Seal 加密集成**
   - 數據加密後存儲 Walrus Blob ID
   - 通過 `seal_approve` 方法實現細粒度訪問控制
   - 只有授權的第三方服務可以解密對應資源

## 🚀 核心功能

### 功能一：用戶數據管理

#### Feature 1: 通用數據管理
- 透過 Walrus 新增、刪除、修改數據（圖片、影片、文字）
- 支持分組管理（Group Name）
- 細粒度權限控制（View/Edit/Delete）

#### Feature 2: 密碼管理
- 透過 Walrus 新增、刪除、修改密碼
- 支持網站密碼、銀行密碼等各類密碼管理
- 自動化密碼同步與驗證

### 功能二：D OAuth 授權機制

#### Feature 1: 服務註冊
- 第三方服務註冊並獲得 `clientId`
- 選擇可請求的資源類型
- 錢包私鑰認證服務身份

#### Feature 2: OAuth 授權流程
- 用戶通過錢包簽名授權第三方服務
- 可選擇性授權特定資源類型
- 支持時間限制的訪問授權

#### Feature 3: 新用戶自動註冊
- 首次登入第三方服務時自動創建密碼
- 無縫整合到 OAuth 流程
- 自動同步到 Bowhead Whale 管理界面

#### Feature 4: 已有用戶快速登入
- 支持 Common 密碼機制
- 一次設定，多服務使用
- 自動驗證用戶輸入

## 📊 工作流程

### Path 1: 服務方註冊
```
廠商 → Bowhead Whale 介面 → 註冊服務
     → 輸入服務名稱、描述、Redirect URL
     → 獲得 clientId
     → 記錄到 DOAuth_Service_AllowList
```

### Path 2: 用戶 D OAuth 登入
```
用戶 → 第三方服務登入按鈕
     → 跳轉 Bowhead Whale OAuth 頁面
     → 錢包簽名授權
     → 合約驗證服務是否在白名單
     → 創建/更新 Auth_List
     → 返回 access_token
```

### Path 3: 服務方獲取用戶資源
```
服務方 → HTTP GET Bowhead Whale API
       → 提供 access_token
       → 合約執行 seal_approve
       → check_policy 驗證授權
       → 返回加密資源 URL
       → 服務方使用 secret_key 解密
```

## 🔐 安全特性

- ✅ **端到端加密** - 所有數據使用 Seal 協議加密
- ✅ **鏈上授權驗證** - 所有授權記錄在鏈上，不可篡改
- ✅ **時間限制訪問** - 支持訪問時效控制
- ✅ **細粒度權限** - View/Edit/Delete 三級權限控制
- ✅ **白名單機制** - 只有註冊服務可以請求授權

## 📁 合約結構

- `seal_private_data.move` - 數據保險庫與 Seal 加密集成
- `oauth_service.move` - OAuth 服務註冊與授權管理
- `utils.move` - 工具函數

## 🔗 相關資源

- [Walrus 文檔](https://github.com/MystenLabs/awesome-walrus)
- [Seal 文檔](https://seal-docs.wal.app/)
- [Sui Move 文檔](https://docs.sui.io/build/move)

---

**Bowhead Whale** - 讓 Web3 用戶數據管理更安全、更自主、更便捷